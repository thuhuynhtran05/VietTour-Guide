<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Địa điểm Du lịch | VietTour Guide</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap">
  <style>
    :root {
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --primary-light: #dbeafe;
      --accent: #fbbf24;
      --text-dark: #1f2937;
      --text-medium: #4b5563;
      --text-light: #6b7280;
      --border: #e5e7eb;
      --white: #ffffff;
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #f9fafb;
      color: var(--text-dark);
      line-height: 1.6;
    }

    /* Header */
    header {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }


    .header-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      color: var(--text-dark);
      font-size: 1.25rem;
      font-weight: 700;
    }

    .logo-icon {
      color: var(--primary);
      width: 2rem;
      height: 2rem;
    }

    .nav {
      display: none;
      gap: 2rem;
      align-items: center;
    }

    @media (min-width: 768px) {
      .nav {
        display: flex;
      }
    }

    .nav-link {
      color: var(--text-medium);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
      font-size: 0.9rem;
    }

    .nav-link:hover {
      color: var(--primary);
    }

    .nav-link.active {
      color: var(--primary);
      font-weight: 600;
    }

    /* Hero Section */
    .hero {
      position: relative;
      height: 500px;
      background: linear-gradient(rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.45)),
      url('https://images.unsplash.com/photo-1583417319070-4a69db38a482?q=80&w=2000&auto=format&fit=crop') center/cover;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .hero::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 100px;
      background: linear-gradient(to bottom, transparent, rgba(249, 250, 251, 0.8));
    }

    .hero-content {
      position: relative;
      z-index: 10;
      text-align: center;
      color: white;
      padding: 0 1rem;
    }

    .hero-title {
      font-size: 3.5rem;
      line-height: 1.1;
      text-shadow: 0px 4px 15px rgba(0,0,0,0.35);
    }


    .hero-title .highlight {
      color: var(--accent);
      font-weight: 800;
    }

    /* Main Content */
    main {
      max-width: 1200px;
      margin: -50px auto 0;
      padding: 0 1.5rem 3rem;
      position: relative;
      z-index: 20;
    }

    /* Section Header */
    .section-header {
      background: white;
      padding: 2rem;
      border-radius: 0.75rem;
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
    }

    .section-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-dark);
      border-left: 4px solid var(--primary);
      padding-left: 1rem;
    }

    /* Search & Filters */
    .filters {
      background: white;
      padding: 2rem;
      border-radius: 0.75rem;
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
    }

    .filter-group {
      flex: 1;
      min-width: 250px;
      display: flex;
      flex-direction: column;
    }

    .filter-label {
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-dark);
    }

    .search-wrapper {
      position: relative;
    }

    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 1.25rem;
      height: 1.25rem;
      color: var(--text-light);
      pointer-events: none;
    }

    .search-input,
    .filter-select {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid var(--border);
      border-radius: 0.5rem;
      font-size: 0.9rem;
      transition: all 0.2s;
      background: white;
    }

    .search-input {
      padding-left: 3rem;
    }

    .search-input:focus,
    .filter-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .filter-select {
      cursor: pointer;
    }

    /* Location Cards */
    .locations-grid {
      display: grid;
      gap: 1.5rem;
    }

    .location-card {
      background: white;
      border-radius: 0.75rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border);
      overflow: hidden;
      display: flex;
      transition: all 0.3s;
      text-decoration: none;
      color: inherit;
    }

    .location-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow);
      border-color: var(--primary-light);
    }

    .location-image-wrapper {
      width: 240px;
      height: 180px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .location-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }

    .location-card:hover .location-image {
      transform: scale(1.05);
    }

    .location-content {
      padding: 1.5rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .location-name {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
      color: var(--text-dark);
    }

    .location-category {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--primary-light);
      color: var(--primary);
      padding: 0.375rem 1rem;
      border-radius: 2rem;
      font-size: 0.8rem;
      font-weight: 600;
      width: fit-content;
      margin-bottom: 1rem;
    }

    .category-icon {
      width: 1rem;
      height: 1rem;
    }

    .location-description {
      color: var(--text-medium);
      font-size: 0.9rem;
      line-height: 1.6;
      margin-bottom: 1.25rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .location-meta {
      display: flex;
      gap: 2rem;
      font-size: 0.85rem;
      color: var(--text-light);
      margin-top: auto;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .meta-icon {
      width: 1rem;
      height: 1rem;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-medium);
    }

    .spinner {
      animation: spin 1s linear infinite;
      width: 2rem;
      height: 2rem;
      margin: 0 auto 1rem;
      color: var(--primary);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      background: white;
      border-radius: 0.75rem;
      box-shadow: var(--shadow-sm);
    }

    .empty-icon {
      width: 5rem;
      height: 5rem;
      margin: 0 auto 1.5rem;
      color: var(--text-light);
    }

    .empty-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--text-dark);
    }

    .empty-description {
      color: var(--text-medium);
      font-size: 1rem;
    }

    /* Alert */
    .alert {
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: #fee2e2;
      border: 1px solid #ef4444;
      color: #991b1b;
    }

    .alert svg {
      width: 1.25rem;
      height: 1.25rem;
      flex-shrink: 0;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hero {
        height: 350px;
      }

      .hero-title {
        font-size: 2.75rem;
      }

      .section-title {
        font-size: 1.5rem;
      }

      .filters {
        padding: 1.5rem;
      }

      .location-card {
        flex-direction: column;
      }

      .location-image-wrapper {
        width: 100%;
        height: 200px;
      }

      .location-content {
        padding: 1.25rem;
      }

      .location-name {
        font-size: 1.25rem;
      }

      .location-meta {
        flex-wrap: wrap;
        gap: 1rem;
      }
    }
  </style>
</head>
<body>
<!-- Header -->
<header>
  <div class="header-container">
    <a href="index.html" class="logo">
      <svg class="logo-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
        <circle cx="12" cy="10" r="3"></circle>
      </svg>
      <span>VietTour Guide</span>
    </a>
    <nav class="nav">
      <a href="index.html" class="nav-link">Trang chủ</a>
      <a href="locations.html" class="nav-link active">Địa điểm</a>
      <a href="guides.html" class="nav-link">Hướng dẫn viên</a>
      <a href="my-bookings.html" class="nav-link">Tour của tôi</a>
      <span id="userName" style="color: var(--text-dark); font-weight: 600;">Khách hàng</span>
    </nav>
  </div>
</header>

<!-- Hero -->
<section class="hero">
  <div class="hero-content">
    <h1 class="hero-title">Địa điểm <span class="highlight">Du lịch</span></h1>
  </div>
</section>

<!-- Main -->
<main>
  <!-- Section Header -->
  <div class="section-header">
    <h2 class="section-title">Thông tin địa điểm</h2>
  </div>

  <!-- Filters -->
  <div class="filters">
    <div class="filter-group">
      <label class="filter-label">Tìm kiếm địa điểm</label>
      <div class="search-wrapper">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input
                type="text"
                id="searchInput"
                class="search-input"
                placeholder="Nhập tên địa điểm..."
        />
      </div>
    </div>
    <div class="filter-group">
      <label class="filter-label" for="categoryFilter">Danh mục</label>
      <select class="filter-select" id="categoryFilter">
        <option value="">Tất cả danh mục</option>
        <option value="Di tích lịch sử">Di tích lịch sử</option>
        <option value="Danh lam thắng cảnh">Danh lam thắng cảnh</option>
        <option value="Bảo tàng">Bảo tàng</option>
        <option value="Khu du lịch">Khu du lịch</option>
      </select>
    </div>
  </div>

  <!-- Alert -->
  <div id="alertContainer"></div>

  <!-- Loading -->
  <div id="loadingState" class="loading">
    <svg class="spinner" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
    </svg>
    <div>Đang tải danh sách địa điểm...</div>
  </div>

  <!-- Locations Grid -->
  <div id="locationsGrid" class="locations-grid"></div>

  <!-- Empty State -->
  <div id="emptyState" class="empty-state" style="display: none;">
    <svg class="empty-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
      <circle cx="12" cy="10" r="3"></circle>
    </svg>
    <h3 class="empty-title">Không tìm thấy địa điểm</h3>
    <p class="empty-description">Vui lòng thử lại với từ khóa hoặc bộ lọc khác</p>
  </div>
</main>

<script>
  // Global state
  let allLocations = [];
  const userName = localStorage.getItem('userName');

  if (userName) {
    document.getElementById('userName').textContent = userName;
  }

  // Show alert
  function showAlert(message) {
    const container = document.getElementById('alertContainer');
    const alert = document.createElement('div');
    alert.className = 'alert';
    alert.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        ${message}
      `;
    container.appendChild(alert);
    setTimeout(() => alert.remove(), 5000);
  }

  // Fetch locations
  async function fetchLocations() {
    const loading = document.getElementById('loadingState');
    const grid = document.getElementById('locationsGrid');
    const empty = document.getElementById('emptyState');

    try {
      loading.style.display = 'block';
      grid.innerHTML = '';
      empty.style.display = 'none';

      const res = await fetch('http://localhost:4000/api/locations');
      if (!res.ok) throw new Error('Không thể tải danh sách địa điểm');

      allLocations = await res.json();
      loading.style.display = 'none';

      if (!allLocations.length) {
        empty.style.display = 'block';
        return;
      }

      renderLocations(allLocations);
    } catch (error) {
      loading.style.display = 'none';
      showAlert(error.message);
    }
  }

  // Render locations
  function renderLocations(locations) {
    const grid = document.getElementById('locationsGrid');
    const empty = document.getElementById('emptyState');

    grid.innerHTML = '';

    if (!locations.length) {
      empty.style.display = 'block';
      return;
    }

    empty.style.display = 'none';

    locations.forEach(loc => {
      const img = loc.images?.length
              ? `http://localhost:4000${loc.images[0]}`
              : 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=400&h=300&fit=crop';
      console.log('loc =', loc);
      const desc = loc.description
              ? loc.description.substring(0, 120) + (loc.description.length > 120 ? '...' : '')
              : 'Khám phá địa điểm tuyệt vời này';

      const date = new Date(loc.createdAt).toLocaleDateString('vi-VN');

      const card = document.createElement('a');
      card.className = 'location-card';
      card.href = `location.html?id=${loc._id}`;

      card.innerHTML = `
          <div class="location-image-wrapper">
            <img
              src="${img}"
              alt="${loc.name}"
              class="location-image"
              onerror="this.src='https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=400&h=300&fit=crop'"
            />
          </div>
          <div class="location-content">
            <h3 class="location-name">${loc.name}</h3>
            <div class="location-category">
              <svg class="category-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
              </svg>
              ${loc.category || 'Chưa phân loại'}
            </div>
            <p class="location-description">${desc}</p>
            <div class="location-meta">
              <div class="meta-item">
                <svg class="meta-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12,6 12,12 16,14"></polyline>
                </svg>
                ${date}
              </div>
              <div class="meta-item">
                <svg class="meta-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                ${loc.guideCount || 0} HDV
              </div>
            </div>
          </div>
        `;

      grid.appendChild(card);
    });
  }

  // Filter locations
  function filterLocations() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    const category = document.getElementById('categoryFilter').value;

    let filtered = [...allLocations];

    if (search) {
      filtered = filtered.filter(loc =>
              loc.name.toLowerCase().includes(search) ||
              (loc.description && loc.description.toLowerCase().includes(search))
      );
    }

    if (category) {
      filtered = filtered.filter(loc => loc.category === category);
    }

    renderLocations(filtered);
  }

  // Event listeners
  document.getElementById('searchInput').addEventListener('input', filterLocations);
  document.getElementById('categoryFilter').addEventListener('change', filterLocations);

  // Init
  // ===== SEARCH FROM INDEX.HTML =====
  const urlParams = new URLSearchParams(window.location.search);
  const searchDestination = urlParams.get('destination');
  const searchStartDate = urlParams.get('startDate');
  const searchEndDate = urlParams.get('endDate');

  // Fetch locations
  async function fetchLocations() {
    const loading = document.getElementById('loadingState');
    const grid = document.getElementById('locationsGrid');
    const empty = document.getElementById('emptyState');

    try {
      loading.style.display = 'block';
      grid.innerHTML = '';
      empty.style.display = 'none';

      const res = await fetch('http://localhost:4000/api/locations');
      if (!res.ok) throw new Error('Không thể tải danh sách địa điểm');

      allLocations = await res.json();
      loading.style.display = 'none';

      if (!allLocations.length) {
        empty.style.display = 'block';
        return;
      }

      // ✅ Auto-fill search box nếu có search params
      if (searchDestination) {
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
          searchInput.value = searchDestination;
          searchInput.style.borderColor = '#2563eb';
          searchInput.style.boxShadow = '0 0 0 3px rgba(37,99,235,0.1)';
        }
        showSearchInfo();
        filterLocations(); // Auto filter
      } else {
        renderLocations(allLocations);
      }
    } catch (error) {
      loading.style.display = 'none';
      showAlert(error.message);
    }
  }

  // Render locations
  function renderLocations(locations) {
    const grid = document.getElementById('locationsGrid');
    const empty = document.getElementById('emptyState');

    grid.innerHTML = '';

    if (!locations.length) {
      empty.style.display = 'block';
      return;
    }

    empty.style.display = 'none';

    locations.forEach(loc => {
      const img = loc.images?.length
              ? `http://localhost:4000${loc.images[0]}`
              : 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=400&h=300&fit=crop';
      const desc = loc.description
              ? loc.description.substring(0, 120) + (loc.description.length > 120 ? '...' : '')
              : 'Khám phá địa điểm tuyệt vời này';

      const date = new Date(loc.createdAt).toLocaleDateString('vi-VN');

      const card = document.createElement('a');
      card.className = 'location-card';
      card.href = `location.html?id=${loc._id}`;

      card.innerHTML = `
          <div class="location-image-wrapper">
            <img
              src="${img}"
              alt="${loc.name}"
              class="location-image"
              onerror="this.src='https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=400&h=300&fit=crop'"
            />
          </div>
          <div class="location-content">
            <h3 class="location-name">${loc.name}</h3>
            <div class="location-category">
              <svg class="category-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
              </svg>
              ${loc.category || 'Chưa phân loại'}
            </div>
            <p class="location-description">${desc}</p>
            <div class="location-meta">
              <div class="meta-item">
                <svg class="meta-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12,6 12,12 16,14"></polyline>
                </svg>
                ${date}
              </div>
              <div class="meta-item">
                <svg class="meta-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                ${loc.guideCount || 0} HDV
              </div>
            </div>
          </div>
        `;

      grid.appendChild(card);
    });
  }

  // Filter locations
  function filterLocations() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    const category = document.getElementById('categoryFilter').value;

    let filtered = [...allLocations];

    if (search) {
      filtered = filtered.filter(loc =>
              loc.name.toLowerCase().includes(search) ||
              (loc.description && loc.description.toLowerCase().includes(search))
      );
    }

    if (category) {
      filtered = filtered.filter(loc => loc.category === category);
    }

    renderLocations(filtered);
  }

  // Show search info banner
  function showSearchInfo() {
    if (searchDestination || searchStartDate || searchEndDate) {
      const infoHtml = `
        <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
                    border: 1px solid #60a5fa;
                    border-radius: 12px;
                    padding: 16px 20px;
                    margin-bottom: 20px;
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    animation: slideDown 0.3s ease;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <div style="flex: 1;">
            <div style="font-weight: 700; color: #1e40af; margin-bottom: 4px;">
              Kết quả tìm kiếm
            </div>
            <div style="font-size: 14px; color: #1e40af;">
              ${searchDestination ? `Điểm đến: <strong>${searchDestination}</strong>` : ''}
              ${searchStartDate ? ` • Từ ${new Date(searchStartDate).toLocaleDateString('vi-VN')}` : ''}
              ${searchEndDate ? ` đến ${new Date(searchEndDate).toLocaleDateString('vi-VN')}` : ''}
            </div>
          </div>
          <button onclick="clearSearch()" style="background: transparent; border: none; cursor: pointer; color: #2563eb; font-weight: 600; padding: 6px 12px; border-radius: 6px; transition: all 0.2s;">
            Xóa bộ lọc
          </button>
        </div>
        <style>
          @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
          }
        </style>
      `;

      const filtersSection = document.querySelector('.filters-section');
      if (filtersSection) {
        filtersSection.insertAdjacentHTML('beforebegin', infoHtml);
      }
    }
  }

  // Clear search params
  function clearSearch() {
    window.history.replaceState({}, '', 'locations.html');
    window.location.reload();
  }

  // Event listeners
  document.getElementById('searchInput').addEventListener('input', filterLocations);
  document.getElementById('categoryFilter').addEventListener('change', filterLocations);

  // Init
  fetchLocations();
</script>
</body>
</html>